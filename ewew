#include <iostream>
#include <cstring>
#include <fstream>
#include <cctype>

using namespace std;


template <class Type>
class Stack {
Type* arr;
int head,tail, size, maxsize;
public :
   Stack () ;
   void push ( Type sym ) ;
   Type pop();
   int Size();
   void resize(int maxsize);
   Type Top();
} ;
//----------------

template <class Type>
Stack<Type>::Stack()
{
   arr = new char[100];
   head = size = 0 ;
   tail= -1;
   maxsize = 100;
}
//----------------

template <class Type>
void Stack<Type>::push (Type sym){
    if (size == maxsize){
            maxsize *= 2;

    }

        tail++;
        size++;
        arr[tail] = sym;
}
//----------------
template <class Type>
Type Stack<Type>::pop(){
    char x;
    x = arr[tail];
        tail--;
        size--;
        return(x);
}

//----------------

template <class Type>
int Stack<Type>::Size(){
    return (size);
}


template <class Type>
void Stack<Type>::resize(int new_size){
    Type* new_arr = new Type[new_size];
    int i;
    for (i = 0; i < size; i++){
        new_arr[i] = arr[i];
    }
    delete[] arr;
    maxsize = new_size;
    arr = new_arr;

}

template <class Type>
Type Stack<Type>::Top(){
    return(arr[tail]);

}


int prioritet(char ch){
    switch(ch){
        case '+': case'-':{
            return 1;
        }
        case '*': case '\\':{
            return 2;
        }
        case '^':{
             return 3;
        }
    default:{
        return 0;
    }

    }
}

bool isOperation(char x){
    if (x == '^' || x == '*' || x == '/' || x == '+' || x == '-')
        return true;
    return false;
}

bool isNumber(char x){
    if (isdigit(x))
        return true;
    return false;
}

bool isVar(char x){
    if (isalpha(x))
        return true;
    return false;
}


int main(){ //A*B+C*D = +*AB*CD   C+D*E+Q = ++C*DEQ  (A+B*C)*D =
        int i = 0;
        const char space = ' ';
        string ans;
        string infix;
        Stack <char> operations;
        ifstream infile("infix.txt");
        getline(infile, infix);
        infile.close();
        i = infix.length();
        while (i >= 0){

            if(isVar(infix[i]) || isNumber(infix[i])){
                ans.insert(0, 1, infix[i]);
                if(!isVar(infix[i-1]) && !(isNumber(infix[i-1])))
                     ans.insert(0, 1, space);

            }
            if (isOperation(infix[i])){
                if(!operations.Size())
                    operations.push(infix[i]);
                else{
                    while(prioritet(infix[i]) <= prioritet(operations.Top()) && operations.Size()){
                        ans.insert(0, 1, operations.pop());
                        ans.insert(0, 1, space);
                    }
                    operations.push(infix[i]);
                }

            }
            if(infix[i] ==')'){
                operations.push(infix[i]);
            }
           if(infix[i] =='('){
               while (prioritet(operations.Top())){
                  ans.insert(0, 1, operations.pop());
                  ans.insert(0, 1, space);

               }
               operations.pop();
            }

            i--;
        }
        while(operations.Size()){
            ans.insert(0, 1, operations.pop());
            ans.insert(0, 1, space);
        }
        ofstream out("prefix.txt");
        out<<ans;
        cout<<"Выражение записано в префиксном форме"<<endl;
        out.close();

}



